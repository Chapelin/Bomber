<!doctype html>
<html>
<head>
    <meta charset="UTF-8" />
    <title>hello phaser!</title>
    <script src="phaser.js"></script>
    <script src="socket.io.js"></script>
</head>
<body>

    <script type="text/javascript">

        window.onload = function() {
            var game = new Phaser.Game(800, 600, Phaser.AUTO, '', { preload: preload, create: create, update : update });
            
            var platforms;
            var player;
            var cursors;
            var stars;
            var score = 0;
            var scoreText;
            var son;
            var baddies;
            var end = false;
            var map;
            var layer;

            function preload () {
                game.load.tilemap('map', 'assets/map.csv', null, Phaser.Tilemap.CSV);
                game.load.image('tiles', 'assets/map1.png');

                game.load.spritesheet("dude", "assets/dude.png",32,48);


            }

            function create () {
                 game.physics.startSystem(Phaser.Physics.ARCADE);
                map = game.add.tilemap('map',16,16);
                map.addTilesetImage('tiles');

                map.setCollision(0);


                layer = map.createLayer(0);
                layer.debug = true;
                // layer.resizeWorld();
               



                player = game.add.sprite(32,40, 'dude');
                game.physics.enable(player);

                player.body.bounce.y = 0;
                player.body.gravity.y = 0;
                player.body.collideWorldBounds = true;
                player.animations.add('left', [0, 1, 2, 3], 10, true);
                player.animations.add('right', [5, 6, 7, 8], 10, true);

                game.stage.disableVisibilityChange = true;

                cursors = game.input.keyboard.createCursorKeys();

            }


            function dummy(t,y)
            {
                console.log(t);
                console.log(y);
            }

            function update() {
                player.body.velocity.x = 0;
                player.body.velocity.y = 0;
                //

           // game.physics.arcade.collide(player,layer);
               // game.physics.arcade.overlap(player,layer,dummy);


                
                if(cursors.left.isDown)
                {
                    player.body.velocity.x = -150;
                    player.animations.play('left');
                }
                else
                    if (cursors.right.isDown) {
                        player.body.velocity.x = +150;
                        player.animations.play('right');
                    }
                    else
                        if (cursors.up.isDown) {
                            player.body.velocity.y = -150;
                            player.animations.play('right');
                        }
                        else  
                           if (cursors.down.isDown) {
                            player.body.velocity.y = +150;
                            player.animations.play('right');
                        }
                        else  
                        {
                            player.animations.stop();
                            player.frame = 4;
                        }
                        if(game.input.keyboard.isDown(Phaser.Keyboard.SPACEBAR))
                        {
                            majScore(524);
                        }
                    }
                };

            </script>

        </body>
        </html>